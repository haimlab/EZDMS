{% extends "base.html" %}

<script src="scripts/scripts.js"></script>

{% block content %}
<div class="title-container">
    <div class="inner-title">
        <h1 class="page-title">Variable Sites Finder</h1>
    </div>
</div>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>

    #div1, #div2, #div3 {
      float: left;
      width: 100px;
      height: 100px;
      margin: 10px;
      padding: 10px;
      border: 1px solid black;
    }


/* Base container styles */
.container {
    display: flex;
    justify-content: flex-start;
    padding: 20px;
    box-sizing: border-box;
    margin-bottom: 30px; 
    background-color: #f4f7fa; 
}

.title-container {
    width: 100%; 
    background-color: #f8f9fa; 
    padding: 0px; 
    box-sizing: border-box;
}

.inner-title {
    background-color: #fff; 
    margin: 0 auto;
    padding: 15px; 
    border: 1px solid #ccc; 
    border-radius: 8px; 
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
    max-width: 95%; 
}

.page-title {
    text-align: Left;
    color: #2c3e50; 
    font-family: 'Arial', sans-serif;
    margin-left: 20px;
    font-size: 28px; 
    font-weight: bold;
    margin: 0; 
    text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
}

.container .box {
    width: 28%;
    padding: 20px;
    background-color: #ffffff;
    border: 1px solid #dadee4; 
    border-radius: 10px; 
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06); 
    margin: 10px;
}


.center-form label {
    display: block;
    margin-bottom: 5px; 
    font-size: 16px; 
    color: #333; 
    font-weight: bold; 
}

.container input[type="file"],
.container input[type="text"],
.container input[type="number"],
.container input[type="image"],
.container button {
    width: 100%; 
    padding: 10px 15px; 
    margin-bottom: 0px;
    border: 1px solid #ccd1d9; 
    border-radius: 5px; 
    box-sizing: border-box;
    font-size: 15px; 
}
.container .submit-btn {
    background-color: #5a7694; 
    color: white;
    font-size: 16px;
    padding: 12px 20px;
    border-radius: 8px;
    transition: background-color 0.3s ease, transform 0.2s ease; 
}

.container .submit-btn:hover {
    background-color: #475F77; 
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transform: translateY(-2px); 
}


   
  </style>
</head>
<body>
    <div class="container">
        <!-- Box 1 -->
        <div class="box">
            <div class="center-form">
                <form method="post" enctype="multipart/form-data">
                    <div class="center">
                        <label for="fastaFile">Reference sequence (.fasta):</label>
                        <input type="text" id="file_name" name="file_name" placeholder="Ref_375X.fa"><br><br>
                        <span class="error" style="display:none;color:red;">Only accepts .fasta or .fa formats.</span>
                        <br><br>
                        <label for="fastqFile">Data sequence (.fastq):</label>
                        <input type="text" id="file_name" name="file_name" placeholder="BNKWKD_3_Library_375X.fastq"><br><br>
                        <span class="error" style="display:none;color:red;">Only accepts .fastq format.</span><br><br>
                        
                        <label for="lname">Output file name:</label>
                        <input type="text" id="file_name" name="file_name" value="Variable_sites_375X_BNKWKD_3_Library"><br><br>
                
                        <label for="lname"> Number of matching nucleotides 5 prime:</label>
                        <input type="number" id="distance_5_prime" name="distance_5_prime" value="8" min="0" max="99"><br><br>
                        <label for="lname">Number of matching nucleotides 3 prime:</label>
                        <input type="number" id="nucleotide_match" name="nucleotide_match" value="8" min="0" max="99"><br><br>
                
                        <label for="fname">Phred score threshold:</label>
                        <input type="number" id="phred_score" name="phred_score" value="20" min="0" max="99"><br><br>
                
                        <label for="fname">Number of variable sites:</label>
                        <input type="number" id="variable_sites_number" name="variable_sites_number" value="2" min="1" max="5"><br><br>
                
                        <label for="lname">(optional) barcode check:</label>
                        <input type="text" id="barcode" name="barcode" value=""><br><br>
                    </div>
                    
                    <button type="submit" class="submit-btn">Submit</button>
                </form>
            </div>
        </div>
    
        <!-- Box 2 -->
        <div class="box">
            <div class="help-section">
                  <!-- The clickable image -->
                    <p>Drag the image into the rectangle:</p>

                    <!-- Drop zones -->
                    <div id="div1" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <img src="static/A0L.png" draggable="true" ondragstart="drag(event)" id="BNKWKD_3_Library_375X.fastq" width="100" height="100"style="cursor: pointer;">

                    </div>
                    <div id="div2" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <img src="static/FGV.png" draggable="true" ondragstart="drag(event)" id="Ref_375X.fa" width="100" height="100" style="cursor: pointer;">
                    </div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <img src="static/FGV.png" draggable="true" ondragstart="drag(event)" id="Ref_375X.fa" width="100" height="100" style="cursor: pointer;">
                    </div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <img src="static/FGV.png" draggable="true" ondragstart="drag(event)" id="Ref_375X.fa" width="100" height="100" style="cursor: pointer;">
                    </div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <img src="static/FGV.png" draggable="true" ondragstart="drag(event)" id="Ref_375X.fa" width="100" height="100" style="cursor: pointer;">
                    </div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        </div>
    </div>


  

  <script>
   // Links for the images (can be different files or URLs)
    const fileLink1 = 'static/BNKWKD_3_Library_375X.fastq';  // Replace with the link to the first file
    const fileLink2 = 'static/Ref_375X.fa'; // Replace with the link to the second file

    // Image 1 (drag1) click handler to open the file in a new tab
    document.getElementById('BNKWKD_3_Library_375X.fastq').addEventListener('click', function() {
      window.open(fileLink1, '_blank');  // Opens the first file in a new tab
    });

    // Image 2 (drag2) click handler to open the file in a new tab
    document.getElementById('Ref_375X.fa').addEventListener('click', function() {
      window.open(fileLink2, '_blank');  // Opens the second file in a new tab
    });

    let isDragging = false;

    // Detect if user is dragging or clicking
    img.addEventListener('mousedown', () => {
      isDragging = false;  // Assume it's a click initially
    });

    img.addEventListener('mousemove', () => {
      isDragging = true;  // It's a drag if mouse moves
    });

    // If it's not a drag, open the file in a new tab
    img.addEventListener('click', (e) => {
      if (isDragging) {
        e.preventDefault();  // Prevent the default click action if it's a drag
        isDragging = false;
      } else {
        openFileInNewTab(fileUrl);
      }
    });

    // Function to open the file in a new tab
    function openFileInNewTab(url) {
      window.open(url, '_blank');  // Open the file URL in a new tab
    }

    function drag(ev) {
      ev.dataTransfer.setData("text", ev.target.id);  // Store image ID during drag
    }

    // Function to allow the drop on the target divs or text input
    function allowDrop(ev) {
      ev.preventDefault();  // Allow the drop
    }

    // Function to handle the drop event
    function drop(ev) {
      ev.preventDefault();  // Prevent default drop behavior

      var data = ev.dataTransfer.getData("text");  // Get the dragged element ID
      var draggedElement = document.getElementById(data);

      // Append the dragged image to the target div
      ev.target.appendChild(draggedElement);

      // Check if the drop target is the text input field
    }
  </script>
</body>
{% endblock %}
