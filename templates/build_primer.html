{% extends "base.html" %}

<!-- {% block title %}Build Primer{% endblock %} -->

{% block content %}

<style>

    #div1, #div2, #div3 {
      float: left;
      width: 100px;
      height: 100px;
      margin: 10px;
      padding: 10px;
      border: 2px solid black;
    }

</style>
<div class="title-container">
    <div class="inner-title">
        <h1 class="page-title">Build Primer</h1>
    </div>
</div>
    <!-- Container for the two boxes -->
    <div class="container">
        <!-- Box 1 -->
        <div class="box">
			<div class="center-form">
				<form method="post" enctype="multipart/form-data">
					<div class="center">
                            <label for="fname">Reference sequence (.fasta):</label>
                            <input type="file" id="files" name="file1" accept=".fasta,.fa" /><br><br>
                            <label for="lname">Output file name:</label>
                            <input type="text" id="file_name" name="file_name" value="your_out_put_file"><br><br>
                
                        <label for="fname">Number of variable sites:</label>
                        <input type="number" id="variable_sites_number" name="variable_sites_number" value="2" min="1" max="5"><br><br>
                        </div>
					
				   <button type="submit" class="submit-btn" data-toggle="tooltip" data-placement="right" title="Submit Fastq file for FQ V search">Submit</button>
				</form>
			</div>
        </div>

        <!-- Box 2 -->
		<div style="display: flex; flex-direction: column; flex-grow: 1;">
			<div class="box"   style="width: 55%;">
				<div class="help-section">
					  <!-- The clickable image -->
					  <h2>Sample files</h2>
	
						<!-- Drop zones -->
						<div id="div1" ondrop="drop(event)" ondragover="allowDrop(event)">
							<img src="static/A0L.png" draggable="true" ondragstart="drag(event)" id="BNKWKD_3_Library_375X.fastq" width="100" height="100"style="cursor: pointer;">
	
						</div>
	
						<div id="div2" ondrop="drop(event)" ondragover="allowDrop(event)">
							<img src="static/FGV.png" draggable="true" ondragstart="drag(event)" id="Ref_375X.fa" width="100" height="100" style="cursor: pointer;">
						</div>
	
						<div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)">
							<img src="static/FGV.png" draggable="true" ondragstart="drag(event)" id="Variable_Sites_BNKWKD.xlsx" width="100" height="100" style="cursor: pointer;">
						</div>
	
						<div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
					</div>
			</div>
			<div class="box"  style="width: 55%;">
				<div class="help-section">
					<h2>Build primer</h2>
					<p>The <strong>Build primer</strong> tool requires two input parameters. Below is a detailed explanation of each:</p>
					<p>The tool creates the 4 primers needed to create a plasmid library from a reference sequence. 
	
						The tool creates the 4 primers needed to create a plasmid library from a reference sequence in a text file (txt). 
						Forward Primer 1 (F1): Primer at the very beginning of the sequence needed for PCR on the full sequence. 
						Forward Primer 2 (F2): Primer after the 3' end of the variable site without overlapping the site. 
						Forward Primer 1 (F1): The 60 base pair primer that covers the variable sequence. 
						Reverse Primer 2 (R2): Primer at the end of sequence needed for PCR on the full sequence. 
						
						Any sequences with basic self-binding or other errors will be flagged at the end of the text file. 

					</p>
					<li><strong>Reference Sequence (.fasta)</strong>
					<ul>
						This is the fastq file containing sequencing data from a plasmid library. 
						The library should be derived from the reference sequence (provided above).  
						The tool will use this file to compare against the reference to identify variable sites. 
					</ul>
					</li>
					<li><strong>Number of Variable Sites</strong>
						<ul>This field specifies the expected number of variable sites in the reference sequence. If the number of variable sites detected does not match this expectation, the program will return an error, indicating a mismatch.</u>
					</li>
				
				</div>
        </div>
    </div>
	<script>
		// Links for the images (can be different files or URLs)
		 const fileLink1 = 'static/BNKWKD_3_Library_375X.fastq';  // Replace with the link to the first file
		 const fileLink2 = 'static/Ref_375X.fa'; // Replace with the link to the second file
		 const fileLink3 = 'static/Variable_Sites_BNKWKD.xlsx';
		 // Image 1 (drag1) click handler to open the file in a new tab
		 document.getElementById('BNKWKD_3_Library_375X.fastq').addEventListener('click', function() {
		   window.open(fileLink1, '_blank');  // Opens the first file in a new tab
		 });
	 
		 // Image 2 (drag2) click handler to open the file in a new tab
		 document.getElementById('Ref_375X.fa').addEventListener('click', function() {
		   window.open(fileLink2, '_blank');  // Opens the second file in a new tab
		 });
	
			  // Image 2 (drag2) click handler to open the file in a new tab
		document.getElementById('Variable_Sites_BNKWKD.xlsx').addEventListener('click', function() {
		   window.open(fileLink3, '_blank');  // Opens the second file in a new tab
		 });
	
		 
	 
		 let isDragging = false;
	 
		 // Detect if user is dragging or clicking
		 img.addEventListener('mousedown', () => {
		   isDragging = false;  // Assume it's a click initially
		 });
	 
		 img.addEventListener('mousemove', () => {
		   isDragging = true;  // It's a drag if mouse moves
		 });
	 
		 // If it's not a drag, open the file in a new tab
		 img.addEventListener('click', (e) => {
		   if (isDragging) {
			 e.preventDefault();  // Prevent the default click action if it's a drag
			 isDragging = false;
		   } else {
			 openFileInNewTab(fileUrl);
		   }
		 });
	 
		 // Function to open the file in a new tab
		 function openFileInNewTab(url) {
		   window.open(url, '_blank');  // Open the file URL in a new tab
		 }
	 
		 function drag(ev) {
		   ev.dataTransfer.setData("text", ev.target.id);  // Store image ID during drag
		 }
	 
		 // Function to allow the drop on the target divs or text input
		 function allowDrop(ev) {
		   ev.preventDefault();  // Allow the drop
		 }
	 
		 // Function to handle the drop event
		 function drop(ev) {
		   ev.preventDefault();  // Prevent default drop behavior
	 
		   var data = ev.dataTransfer.getData("text");  // Get the dragged element ID
		   var draggedElement = document.getElementById(data);
	 
		   // Append the dragged image to the target div
		   ev.target.appendChild(draggedElement);
	 
		   // Check if the drop target is the text input field
		 }
	</script>

{% endblock %}
<script>
	document.addEventListener("DOMContentLoaded", function() {
		var sections = document.querySelectorAll('.help-section h2');
		sections.forEach(function(header) {
			header.addEventListener('click', function() {
				this.parentNode.classList.toggle('active');
			});
		});
	});
</script>


	